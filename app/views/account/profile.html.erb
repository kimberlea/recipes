<div class="header-space"></div>

<div class="account-profile-container">
  <div class="col-md-12">
    <h1>Your Profile</h1>

    <div class="profile-picture">
      <img src="<%= current_user.picture_url %>" class="img-circle" style="width: 70px; height: 70px;"/>
    </div>

    <div class="profile-name">
       <a href="<%= current_user.view_path %>"><%= current_user.full_name %></a>
    </div>
    <div class="profile-status">
      <div class="status-info col-xs-4 pad-0">
        <div class="status-info-number">
          <%= current_user.recipes.count %>
          </div>
        <div class="status-info-title">
          recipes
        </div>
      </div>

      <div class="status-info col-xs-4 pad-0">
        <div class="status-info-number">
          <%= current_user.followings_of_me.count %>
        </div>
        <div class="status-info-title">
          followers
        </div>
      </div>

      <div class="status-info col-xs-4 pad-0">
        <div class="status-info-number">
          <%= current_user.followings_by_me.count %>
        </div>
        <div class="status-info-title">
          following
        </div>
      </div>
    </div>

  <div class="logout">
    <a class="btn btn-inverse" href="/logout">Log Out</a>
  </div>

  <div class="personal-settings">
    <h3> Edit Your Personal Settings</h3>
  </div>
  <div>
    <form class="form-horizontal">
      <div class="img-change">
        <input type="file" name="picture">
        <button type="button" class="btn btn-success" onclick="updatePicture();">
          Update Picture
        </button>
      </div>

      <div class="form-group">
        <label for="inputFirst" class="control-label">First Name</label>
        <input type="text" name="first_name" class="form-control input-lg" value="<%= current_user.first_name %>"/>
      </div>

      <div class="form-group">
        <label for="inputLast" class="control-label">Last Name</label>
        <input type="text" name="last_name" class="form-control input-lg" value="<%= current_user.last_name %>"/>
      </div>

      <div class="form-group">
        <label for="inputEmail" class="control-label">Email</label>
        <input type="text" name="email" class="form-control input-lg" value="<%= current_user.email %>"/>
      </div>

      <div class="form-group">
        <label>About Me</label>
        <textarea class="form-control input-lg" name="bio" placeholder="Tell us about yourself."><%= current_user.bio %></textarea>
        
      </div>

      <button type="button" class="btn btn-success btn-lg btn-full" onclick="saveChanges();">
        <i class="fa fa-check"></i>
        Save Changes
      </button>
    </form>
  </div>
</div>

<script>
function saveChanges() {
  var first_name = $('input[name=first_name]').val();
  var last_name = $('input[name=last_name]').val();
  var email = $('input[name=email]').val();
  var bio = $('textarea[name=bio]').val();


  data = {
    first_name: first_name,
    last_name: last_name,
    email: email,
    bio: bio,
  };

  apiRequest({
    url: "/account",
    method: "POST",
    data: data,
    success: function(resp) {
      $.alert(" Your changes have been saved!");
    }
  });

}

function updatePicture() {
  var picture = $('input[name=picture]')[0].files[0];

  data = {
    picture: picture,
  };

  if (picture != null) {
    data['picture'] = picture;
  }

  apiRequest({
    url: "/account",
    method: "POST",
    data: data,
    hasFile: true,
    success: function(resp) {
      updatePage([".navbar", ".profile-picture"]);
    },
    error: function(resp) {
      alert(resp.error);
    }
  });
}

</script>
